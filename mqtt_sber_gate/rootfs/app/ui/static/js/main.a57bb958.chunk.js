(this["webpackJsonpcontroller-client"]=this["webpackJsonpcontroller-client"]||[]).push([[0],{618:function(e,n,t){},619:function(e,n,t){"use strict";t.r(n);var a,r=t(0),c=t(62),i=t.n(c),o=t(56),s=t(7),l=t(30),u=t(37),d=t.n(u),b=t(72),j=function(){var e=Object(b.a)(d.a.mark((function e(n,t){var a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/api/v1/").concat(n),t);case 2:return a=e.sent,e.next=5,a.json();case 5:if(r=e.sent,a.ok){e.next=8;break}throw new Error(r.error);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),O=function(){var e=Object(b.a)(d.a.mark((function e(n){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("categories/".concat(n,"/features"));case 2:return t=e.sent,e.abrupt("return",t.features);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),f=function(){var e=Object(b.a)(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("transformations");case 2:return n=e.sent,e.abrupt("return",n.transformations);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(b.a)(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("categories");case 2:return n=e.sent,e.abrupt("return",n.categories);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(b.a)(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("models");case 2:return n=e.sent,e.abrupt("return",n.models);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=Object(b.a)(d.a.mark((function e(){var n,t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("objects");case 2:return n=e.sent,t=n.objects,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=Object(b.a)(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("devices");case 2:return n=e.sent,e.abrupt("return",n.devices);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=Object(b.a)(d.a.mark((function e(){var n,t,a,r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([m(),x()]);case 2:return n=e.sent,t=Object(l.a)(n,2),a=t[0],r=t[1],c=a.reduce((function(e,n){return e[n.id]=n.model,e}),{}),e.abrupt("return",r.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{model_name:e.model_id?c[e.model_id]:void 0})})));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(b.a)(d.a.mark((function e(n){var t,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="devices",(null===n||void 0===n?void 0:n.id)&&(a+="/".concat(n.id)),Object.values(null!==(t=n.feature_mappings)&&void 0!==t?t:[]).forEach((function(e){var n,t;e.allowed_integer_values&&(e.allowed_integer_values=Object.assign(null!==(n=e.allowed_integer_values.default)&&void 0!==n?n:{},e.allowed_integer_values),delete e.allowed_integer_values.default);e.allowed_float_values&&(e.allowed_float_values=Object.assign(null!==(t=e.allowed_float_values.default)&&void 0!==t?t:{},e.allowed_float_values),delete e.allowed_float_values.default)})),e.next=5,j(a,{method:(null===n||void 0===n?void 0:n.id)?"PUT":"POST",body:JSON.stringify(n)});case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),C=function(){var e=Object(b.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("devices/".concat(n),{method:"DELETE"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),y=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("status");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(b.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("credentials",{method:"POST",body:JSON.stringify(n)});case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),w=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("reload",{method:"POST"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(b.a)(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("aggregations");case 2:return n=e.sent,e.abrupt("return",n.aggregations);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();!function(e){e.transformList="transform-list",e.aggregationList="aggregation-list",e.objectList="object-list",e.deviceList="device-list",e.categoryList="category-list",e.modelList="model-list",e.categoryFeatureList="category-feature-list",e.status="status"}(a||(a={}));var S,L,F,T,M,E,I,V,z,P,R,N,q,A,Q,D,B,J,U,G,Y,H,K,$,W,X,Z,ee,ne,te,ae,re,ce,ie,oe,se,le,ue,de,be,je,Oe,fe,pe,me,ve,xe,he,ge,Ce,ye,ke,we,_e,Se,Le,Fe,Te=t(16),Me=t(17),Ee=t(406),Ie=t(47),Ve=t(629),ze=t(6),Pe=function(){return Object(r.useCallback)((function(e,n){var t=function(){};t=Ee.b.error({content:Object(ze.jsxs)(Re,{children:[Object(ze.jsxs)(Ne,{children:[Object(ze.jsx)(Ve.a,{style:{fontSize:"24px"}}),Object(ze.jsx)(qe,{children:"\u0423\u0432\u044b, \u043d\u043e \u0447\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a"})]}),Object(ze.jsxs)(Ae,{children:[Object(ze.jsx)(Qe,{children:n}),": ",e]}),Object(ze.jsx)(Ie.a,{onClick:function(){t()},children:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"})]}),icon:Object(ze.jsx)("span",{}),duration:10})}),[])},Re=Me.b.div(S||(S=Object(Te.a)(["\n  padding: 1rem;\n"]))),Ne=Me.b.div(L||(L=Object(Te.a)(["\n  display: flex;\n  justify-content: center;\n"]))),qe=Me.b.div(F||(F=Object(Te.a)(["\n  font-size: 1.2em;\n  font-weight: 500;\n  color: #DF2736;\n"]))),Ae=Me.b.div(T||(T=Object(Te.a)(["\n  font-size: 1.2em;\n  margin-top: 0.75rem;\n  max-width: 500px;\n  text-align: left;\n  margin-bottom: 1em;\n"]))),Qe=Me.b.span(M||(M=Object(Te.a)(["\n  opacity: 0.6;\n"]))),De=t(626),Be=t(630),Je={okButtonProps:{size:"large",icon:Object(ze.jsx)(Be.a,{})},cancelButtonProps:{size:"large"},visible:!0,cancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",okText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"},Ue=t(407),Ge=t(87),Ye=t(631),He=t(632),Ke=t(633),$e=Me.b.div(E||(E=Object(Te.a)(["\n  font-size: 23px;\n  margin-bottom: 1em;\n"]))),We=function(e){var n=e.online,t=e.value,a=e.onEdit,r=e.onRefresh,c=e.loading,i=void 0!==c&&c,o=e.error,s=e.onReset,l=t.username,u=t.password,d=t.broker;return Object(ze.jsxs)("section",{children:[Object(ze.jsxs)(rn,{children:[n?Object(ze.jsx)(Xe,{children:"\u0412 \u0441\u0435\u0442\u0438"}):Object(ze.jsx)(Ze,{children:"\u041d\u0435 \u0432 \u0441\u0435\u0442\u0438"}),Object(ze.jsx)(cn,{icon:i?Object(ze.jsx)(Ge.a,{}):Object(ze.jsx)(Ye.a,{}),onClick:r,children:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c"})]}),o?Object(ze.jsx)(sn,{type:"error",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f: ".concat(o)}):Object(ze.jsx)(ln,{}),Object(ze.jsxs)(rn,{children:[Object(ze.jsx)($e,{children:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435"}),Object(ze.jsx)(on,{icon:Object(ze.jsx)(He.a,{}),onClick:s,children:"\u041f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c"})]}),Object(ze.jsxs)(en,{children:[Object(ze.jsx)(tn,{children:"\u041b\u043e\u0433\u0438\u043d"}),Object(ze.jsx)(an,{children:l})]}),Object(ze.jsxs)(en,{children:[Object(ze.jsx)(tn,{children:"\u041f\u0430\u0440\u043e\u043b\u044c"}),Object(ze.jsx)(an,{children:u})]}),Object(ze.jsxs)(nn,{children:[Object(ze.jsx)(tn,{children:"MQTT \u0431\u0440\u043e\u043a\u0435\u0440"}),Object(ze.jsx)(an,{children:d})]}),Object(ze.jsx)(Ie.a,{type:"primary",size:"large",icon:Object(ze.jsx)(Ke.a,{}),onClick:a,children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"})]})},Xe=Me.b.div(I||(I=Object(Te.a)(["\n  color: #29C673;\n  font-weight: 500;\n  position: relative;\n  padding-left: 20px;\n  font-size: 19px;\n  margin-bottom: 24px;\n\n  &:before {\n    content: '';\n    display: block;\n    position: absolute;\n    width: 12px;\n    height: 12px;\n    border-radius: 6px;\n    background: radial-gradient(#29C673, #2bb56c);\n    left: 0;\n    top: 9px;\n    box-shadow: 0 0 4px inset rgba(0, 0, 0, 0.2);\n  }\n"]))),Ze=Object(Me.b)(Xe)(V||(V=Object(Te.a)(["\n  color: #DF2737;\n  \n  &:before {\n    background: radial-gradient(#DF2737, #a82d38);\n    box-shadow: 0 0 4px inset rgba(0, 0, 0, 0.1);\n  }\n"]))),en=Me.b.div(z||(z=Object(Te.a)(["\n  display: flex;\n  \n  & > div:first-child {\n    padding: 8px 20px 8px 0;\n    width: 68px;\n    margin-right: 20px;\n    border-right: 1px solid #dadada;\n  }\n  \n  & > div:last-child {\n    padding-top: 8px;\n  }\n"]))),nn=Object(Me.b)(en)(P||(P=Object(Te.a)(["\n  & > div:first-child {\n    padding-top: 24px;\n  }\n  \n  & > div:last-child {\n    padding-top: 24px;\n  }\n  \n  margin-bottom: 32px;\n"]))),tn=Me.b.div(R||(R=Object(Te.a)(["\n  font-size: 14px;\n  color: #567;\n  transform: translateY(1px);\n"]))),an=Me.b.div(N||(N=Object(Te.a)(["\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n  word-break: break-word;\n"]))),rn=Me.b.div(q||(q=Object(Te.a)(["\n  display: flex;\n  justify-content: space-between;\n"]))),cn=Object(Me.b)(Ie.a)(A||(A=Object(Te.a)(["\n  transform: translateY(1px);\n"]))),on=Object(Me.b)(Ie.a)(Q||(Q=Object(Te.a)(["\n  transform: translateY(3px);\n"]))),sn=Object(Me.b)(Ue.a)(D||(D=Object(Te.a)(["\n  margin: 8px 0 24px 0;\n"]))),ln=Me.b.div(B||(B=Object(Te.a)(["\n  border-bottom: 1px dotted #dadada;\n  margin: 8px 0 24px;\n"]))),un=t(313),dn=t(143),bn=t(233),jn=function(e){var n=e.className;return Object(ze.jsx)(On,{className:n,children:Object(ze.jsx)(fn,{})})},On=Me.b.div(J||(J=Object(Te.a)(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n  background: rgba(255, 255, 255, 0.8);\n"]))),fn=Object(Me.b)(bn.a)(U||(U=Object(Te.a)(["\n  position: relative;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n"]))),pn={labelCol:{span:6},wrapperCol:{span:18}},mn=function(e){var n=e.value,t=e.onChange,a=e.error,c=e.loading,i=void 0!==c&&c,o=Object(r.useCallback)((function(e){t(Object(s.a)(Object(s.a)({},n),e))}),[n,t]);return Object(ze.jsxs)(un.a,Object(s.a)(Object(s.a)({name:"CredentialsForm"},pn),{},{onValuesChange:o,initialValues:n,autoComplete:"off",colon:!1,children:[i&&Object(ze.jsx)(xn,{}),a&&Object(ze.jsx)(vn,{type:"error",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f: ".concat(a)}),Object(ze.jsx)(un.a.Item,{label:"\u041b\u043e\u0433\u0438\u043d",name:"username",rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043b\u043e\u0433\u0438\u043d"}],children:Object(ze.jsx)(dn.a,{})}),Object(ze.jsx)(un.a.Item,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"}],children:Object(ze.jsx)(dn.a,{})}),Object(ze.jsx)(un.a.Item,{label:"MQTT \u0411\u0440\u043e\u043a\u0435\u0440",name:"broker",rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 MQTT \u0411\u0440\u043e\u043a\u0435\u0440"}],children:Object(ze.jsx)(dn.a,{})})]}))},vn=Object(Me.b)(Ue.a)(G||(G=Object(Te.a)(["\n  margin-bottom: 32px;\n"]))),xn=Object(Me.b)(jn)(Y||(Y=Object(Te.a)(["\n  transform: translate(-24px, -79px);\n"]))),hn=function(e){var n,t=Pe(),c=Object(r.useState)(!1),i=Object(l.a)(c,2),s=i[0],u=i[1],d=Object(o.useQuery)(a.status,y,{cacheTime:0}),b=d.data,j=d.isFetching,O=d.refetch,f=Object(r.useCallback)((function(){u((function(e){return!e}))}),[]);return Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(We,{value:null!==(n=null===b||void 0===b?void 0:b.credentials)&&void 0!==n?n:{},online:!!(null===b||void 0===b?void 0:b.online),onEdit:f,onReset:function(){w().then((function(){e.onAfterReload(),O()})).catch((function(e){t(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438")}))},onRefresh:O,loading:j,error:null===b||void 0===b?void 0:b.error}),s&&Object(ze.jsx)(gn,{defaultValues:null===b||void 0===b?void 0:b.credentials,onClose:f,refetchStatus:O,error:null===b||void 0===b?void 0:b.error})]})},gn=function(e){var n=e.onClose,t=e.defaultValues,a=e.error,c=e.refetchStatus,i=Pe(),u=Object(r.useState)(t||{}),d=Object(l.a)(u,2),b=d[0],j=d[1],O=Object(o.useMutation)(k,{onSuccess:function(){n(),c()},onError:function(e){i(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0440\u0435\u043a\u0432\u0438\u0437\u0438\u0442\u043e\u0432")}}),f=O.mutate,p=O.isLoading;return Object(ze.jsx)(De.a,Object(s.a)(Object(s.a)({title:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435",width:700,onOk:function(){return f(b)},onCancel:n},Je),{},{children:Object(ze.jsx)(mn,{value:b,onChange:j,error:a,loading:p})}))},Cn=t(634),yn=t(635),kn=t(636),wn=function(){return Object(ze.jsxs)("section",{children:[Object(ze.jsx)(Ie.a,{type:"link",icon:Object(ze.jsx)(Cn.a,{}),href:"https://developers.sber.ru/docs/ru/smarthome/title-page",target:"_blank",children:"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f"}),Object(ze.jsx)(Ie.a,{type:"link",icon:Object(ze.jsx)(yn.a,{}),href:"LICENSE.html",target:"_blank",children:"\u041b\u0438\u0446\u0435\u043d\u0437\u0438\u044f"}),Object(ze.jsx)(Ie.a,{type:"link",icon:Object(ze.jsx)(kn.a,{}),href:"mailto:smarthome@sberdevices.ru",children:"\u0422\u0435\u0445. \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430"})]})},_n=function(e){var n=e.headerLeft,t=e.headerRight,a=e.contentLeft,r=e.contentRight;return Object(ze.jsxs)(Fn,{children:[Object(ze.jsx)(Tn,{children:Object(ze.jsx)(Mn,{children:Object(ze.jsxs)(En,{children:[Object(ze.jsx)(Ln,{children:Sn}),Object(ze.jsx)(In,{children:"\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 \u0443\u043c\u043d\u044b\u043c \u0434\u043e\u043c\u043e\u043c Sber"}),Object(ze.jsx)("div",{children:Object(ze.jsx)(wn,{})})]})})}),Object(ze.jsx)(Mn,{children:Object(ze.jsxs)(zn,{children:[Object(ze.jsxs)(Rn,{children:[Object(ze.jsx)($e,{children:n}),a]}),Object(ze.jsxs)(Pn,{children:[Object(ze.jsx)($e,{children:t}),r]})]})})]})},Sn=Object(ze.jsxs)("picture",{children:[Object(ze.jsx)("source",{type:"image/webp",srcSet:"https://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/08f02/logo.webp 1x,\nhttps://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/e8cf1/logo.webp 1.5x,\nhttps://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/9a8c7/logo.webp 2x"}),Object(ze.jsx)("source",{srcSet:"https://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/9b0d1/logo.png 1x,\nhttps://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/767bb/logo.png 1.5x,\nhttps://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/a0e46/logo.png 2x"}),Object(ze.jsx)("img",{srcSet:"https://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/9b0d1/logo.png 1x,\nhttps://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/767bb/logo.png 1.5x,\nhttps://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/a0e46/logo.png 2x",src:"https://cdn-app.sberdevices.ru/sberdevices/0.52.0/static/f7aa246b0a403bdde25b798d9da74ad9/9b0d1/logo.png",alt:"",width:"156",height:"21",loading:"lazy"})]}),Ln=Me.b.div(H||(H=Object(Te.a)(["\n  padding-left: 5px;\n"]))),Fn=Me.b.div(K||(K=Object(Te.a)(['\n  min-height: 100vh;\n  background: #F7F7F7;\n  font-family: "SB Sans Text", Roboto, -apple-system, "Helvetica Neue", Helvetica, Arial, sans-serif;\n  color: #323F48;\n  font-size: 16px;\n']))),Tn=Me.b.header($||($=Object(Te.a)(["\n  height: 60px;\n  background: white;\n  box-shadow: rgb(155 155 155 / 15%) 5px 0 14px;\n  margin-bottom: 24px;\n"]))),Mn=Me.b.div(W||(W=Object(Te.a)(["\n  max-width: 1600px;\n  margin: auto;\n"]))),En=Me.b.div(X||(X=Object(Te.a)(["\n  height: 60px;\n  display: flex;\n  align-items: center;\n"]))),In=Me.b.div(Z||(Z=Object(Te.a)(["\n  font-size: 19px;\n  margin-left: 32px;\n  color: #678;\n  flex-grow: 1;\n"]))),Vn=Me.b.div(ee||(ee=Object(Te.a)(["\n  box-shadow: rgba(155, 155, 155, 0.01) 5px 0 14px 0;\n  background: white;\n  padding: 28px 32px;\n  box-sizing: border-box;\n"]))),zn=Me.b.div(ne||(ne=Object(Te.a)(["\n  display: flex;\n"]))),Pn=Object(Me.b)(Vn)(te||(te=Object(Te.a)(["\n  width: 400px;\n  margin-left: 24px;\n"]))),Rn=Object(Me.b)(Vn)(ae||(ae=Object(Te.a)(["\n  flex-grow: 1;\n  min-height: calc(100vh - 108px);\n"]))),Nn=t(157),qn=t(39),An=t(34),Qn=t(312),Dn=t(622),Bn=t(130),Jn=t(57),Un=t(84),Gn=t(625),Yn=t(639),Hn=t(640),Kn=t(623),$n=t(627),Wn=t(95),Xn=t(637),Zn=t(638),et=t(410),nt=t(401),tt=function(e){var n=e.value,t=e.onChange,a=e.transformName,c=e.transformations,i=Object(r.useMemo)((function(){if(n&&"{"===n.substring(0,1))return JSON.parse(n)}),[n]),o=Object(r.useMemo)((function(){if(a){var e=c.find((function(e){return e.name===a}));if(null===e||void 0===e?void 0:e.schema)return JSON.parse(e.schema)}}),[c,a]),s=Object(r.useMemo)((function(){if(a){var e=c.find((function(e){return e.name===a}));if(null===e||void 0===e?void 0:e.ui_schema)return JSON.parse(e.ui_schema)}}),[c,a]),l=Object(r.useMemo)((function(){if(a){var e=c.find((function(e){return e.name===a}));return null===e||void 0===e?void 0:e.help}}),[c,a]);return Object(ze.jsxs)("div",{children:[!!l&&Object(ze.jsx)(at,{message:l}),!!o&&(!!i||!n)&&Object(ze.jsx)(nt.a,{schema:o,uiSchema:s,validator:et.a,onSubmit:function(e){var n=JSON.stringify(e.formData);t&&t(n)},formData:i,children:Object(ze.jsx)(Ie.a,{type:"primary",htmlType:"submit",children:"Submit"})}),(!o||!i&&!!n)&&Object(ze.jsxs)(un.a,{name:"args",labelCol:{span:8},wrapperCol:{span:16},initialValues:{args:n},onFinish:function(e){t&&t(e.args)},autoComplete:"off",children:[Object(ze.jsx)(un.a.Item,{label:"\u0410\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b",name:"args",children:Object(ze.jsx)(dn.a,{defaultValue:"value"})}),Object(ze.jsx)(un.a.Item,{children:Object(ze.jsx)(Ie.a,{type:"primary",htmlType:"submit",children:"Submit"})})]})]})},at=Object(Me.b)(Ue.a)(re||(re=Object(Te.a)(["\n  margin-bottom: 24px;\n"]))),rt=$n.a.Panel,ct=function(e){var n=e.objectTransformations,t=e.onChange,a=e.transformations,c=Object(r.useState)(),i=Object(l.a)(c,2),o=i[0],u=i[1],d=Object(r.useCallback)((function(e){var r=Object(s.a)({},e);if(a.find((function(e){return e.name===r.transform}))){var c=[].concat(Object(qn.a)(n),[r]);t&&t(c),u((function(e){return[].concat(Object(qn.a)(e||[]),[c.length-1])}))}}),[a,n,t]),b=Object(r.useCallback)((function(e){t&&t(n.filter((function(n,t){return t!==e})))}),[n,t]),j=Object(r.useCallback)((function(e){if(e>0){var a=Object(qn.a)(n);a[e-1]=n[e],a[e]=n[e-1],t&&t(a)}}),[n,t]),O=Object(r.useCallback)((function(e){if(e<n.length-1){var a=Object(qn.a)(n);a[e+1]=n[e],a[e]=n[e+1],t&&t(a)}}),[n,t]),f=Object(r.useCallback)((function(e,a){t&&t(n.map((function(n,t){return e===t?Object(s.a)(Object(s.a)({},n),{},{args:a}):n}))),u((function(n){return null===n||void 0===n?void 0:n.filter((function(n){return+n!==e}))}))}),[n,t]),p=Object(r.useMemo)((function(){return a.map((function(e){return{value:e.name}}))}),[a]),m=function(e){return Object(ze.jsxs)("div",{children:[Object(ze.jsx)(Wn.a,{title:"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043d\u0438\u0436\u0435",children:Object(ze.jsx)(Ie.a,{shape:"circle",icon:Object(ze.jsx)(Xn.a,{}),onClick:function(n){n.stopPropagation(),O(e)}})}),Object(ze.jsx)(Wn.a,{title:"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0432\u044b\u0448\u0435",children:Object(ze.jsx)(Ie.a,{shape:"circle",icon:Object(ze.jsx)(Zn.a,{}),onClick:function(n){n.stopPropagation(),j(e)}})}),Object(ze.jsx)(Wn.a,{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e",children:Object(ze.jsx)(Ie.a,{shape:"circle",icon:Object(ze.jsx)(Yn.a,{}),onClick:function(n){n.stopPropagation(),b(e)}})})]})};return Object(ze.jsxs)("div",{children:[Object(ze.jsx)($n.a,{activeKey:o,onChange:function(e){u(Array.isArray(e)?e:[e])},bordered:!1,children:n.map((function(e,n){return Object(ze.jsx)(rt,{header:e.transform,extra:m(n),children:Object(ze.jsx)(tt,{value:e.args,onChange:function(e){return f(n,e)},transformName:e.transform,transformations:a})},n)}))}),Object(ze.jsx)(it,{name:"MappingForm",autoComplete:"off",colon:!1,component:"div",labelCol:{span:4},wrapperCol:{span:14},onValuesChange:d,initialValues:{},children:Object(ze.jsx)(un.a.Item,{label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",name:"transform",children:Object(ze.jsx)(Dn.a,{options:p,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e",disabled:!p.length,allowClear:!0})})})]})},it=Object(Me.b)(un.a)(ce||(ce=Object(Te.a)(["\n  margin-top: 15px;\n"]))),ot=Object(r.memo)((function(e){var n=e.value,t=e.onChange,a=e.transformations,c=void 0===a?[]:a,i=e.transformationsLoading,o=void 0!==i&&i,u=e.objects,d=void 0===u?[]:u,b=Object(r.useState)(),j=Object(l.a)(b,2),O=j[0],f=j[1],p=Object(r.useState)(),m=Object(l.a)(p,2),v=m[0],x=m[1],h=Object(r.useCallback)((function(e){var n=e.id,t=e.description;return Object(ze.jsxs)(lt,{children:[Object(ze.jsx)(ut,{children:n}),Object(ze.jsx)(dt,{children:t})]})}),[]),g=Object(r.useCallback)((function(e){t(Object(s.a)(Object(s.a)({},n),e))}),[n,t]),C=Object(r.useCallback)((function(e){var a={transforms:e};t(Object(s.a)(Object(s.a)({},n),a))}),[n,t]),y=Object(r.useMemo)((function(){var e=d.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{value:e.id,label:h(e)})}));return O?e.filter((function(e){return-1!==e.id.toLocaleLowerCase().indexOf(O.toLocaleLowerCase())})):e}),[d,O,h]),k=Object(r.useMemo)((function(){var e;if(n.status_object)return null===(e=d.find((function(e){return e.id===n.status_object})))||void 0===e?void 0:e.description}),[n,d]),w=Object(r.useMemo)((function(){var e=d.filter((function(e){return!e.readonly})).map((function(e){return Object(s.a)(Object(s.a)({},e),{},{value:e.id,label:h(e)})}));return v?e.filter((function(e){return-1!==e.id.toLocaleLowerCase().indexOf(v.toLocaleLowerCase())})):e}),[d,v,h]),_=Object(r.useMemo)((function(){var e;if(n.status_object)return null===(e=d.find((function(e){return e.id===n.command_object})))||void 0===e?void 0:e.description}),[n,d]);return Object(ze.jsxs)("div",{children:[Object(ze.jsxs)(un.a,{name:"MappingForm",labelCol:{span:6},wrapperCol:{span:18},initialValues:n,onValuesChange:g,autoComplete:"off",colon:!1,component:"div",children:[Object(ze.jsx)(Kn.a,{orientation:"left",plain:!0,children:"\u041e\u0431\u044a\u0435\u043a\u0442\u044b:"}),Object(ze.jsx)(un.a.Item,{label:"\u041e\u0431\u044a\u0435\u043a\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b",name:"command_object",children:Object(ze.jsx)(Dn.a,{options:w,onSearch:x})}),!!_&&Object(ze.jsx)(Bn.a,{children:Object(ze.jsx)(Jn.a,{span:18,offset:6,children:Object(ze.jsx)(st,{message:_})})}),Object(ze.jsx)(un.a.Item,{label:"\u041e\u0431\u044a\u0435\u043a\u0442 \u0441\u0442\u0430\u0442\u0443\u0441\u0430",name:"status_object",children:Object(ze.jsx)(Dn.a,{options:y,onSearch:f})}),!!k&&Object(ze.jsx)(Bn.a,{children:Object(ze.jsx)(Jn.a,{span:18,offset:6,children:Object(ze.jsx)(st,{message:k})})})]}),Object(ze.jsx)(Kn.a,{orientation:"left",plain:!0,children:"\u0422\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438:"}),!!o&&Object(ze.jsx)(jn,{}),!o&&Object(ze.jsx)(ct,{objectTransformations:n.transforms||[],transformations:c,onChange:C})]})})),st=Object(Me.b)(Ue.a)(ie||(ie=Object(Te.a)(["\n  margin-bottom: 24px;\n"]))),lt=Me.b.div(oe||(oe=Object(Te.a)(["\n  padding-bottom: 8px;\n"]))),ut=Me.b.div(se||(se=Object(Te.a)(["\n  font-weight: 500\n"]))),dt=Me.b.div(le||(le=Object(Te.a)(["\n  font-size: 13px;\n"]))),bt=t(402),jt=t(409),Ot=function(e){var n,t,a,c=e.value,i=e.feature,o=e.onChange,u=Object(r.useState)(!1),d=Object(l.a)(u,2),b=d[0],j=d[1],O=Object(r.useMemo)((function(){return i["FLOAT"===i.type?"allowed_float_values":"allowed_integer_values"]}),[i]),f=null!==(n=null===c||void 0===c?void 0:c.min)&&void 0!==n?n:null===O||void 0===O?void 0:O.min,p=null!==(t=null===c||void 0===c?void 0:c.max)&&void 0!==t?t:null===O||void 0===O?void 0:O.max,m=null!==(a=null===c||void 0===c?void 0:c.step)&&void 0!==a?a:null===O||void 0===O?void 0:O.step,v=Object(r.useCallback)((function(e,n){var t=Object(s.a)({},c);null===n?delete t[e]:t[e]=n;var a=Object.keys(t),r=a.includes("min")||a.includes("max")||a.includes("step");r&&(t.default=O),o&&o(r?t:void 0)}),[c,o,O]);return Object(ze.jsx)(ft,{children:b?Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(bt.a,{value:null===c||void 0===c?void 0:c.min,onChange:function(e){return v("min",e)},addonBefore:"\u043c\u0438\u043d",placeholder:String(null===O||void 0===O?void 0:O.min),min:null===O||void 0===O?void 0:O.min,max:null===O||void 0===O?void 0:O.max,controls:!1}),Object(ze.jsx)(bt.a,{value:null===c||void 0===c?void 0:c.max,onChange:function(e){return v("max",e)},addonBefore:"\u043c\u0430\u043a\u0441",placeholder:String(null===O||void 0===O?void 0:O.max),min:null===O||void 0===O?void 0:O.min,max:null===O||void 0===O?void 0:O.max,controls:!1}),"INTEGER"===i.type&&Object(ze.jsx)(bt.a,{value:null===c||void 0===c?void 0:c.step,onChange:function(e){return v("step",e)},addonBefore:"\u0448\u0430\u0433",placeholder:String(null===O||void 0===O?void 0:O.step),min:null===O||void 0===O?void 0:O.step,controls:!1}),Object(ze.jsx)(Ie.a,{type:"link",onClick:function(){return j((function(e){return!e}))},shape:"circle",icon:b?Object(ze.jsx)(jt.a,{}):Object(ze.jsx)(Ke.a,{})})]}):Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(pt,{children:f})," \u2013 ",Object(ze.jsx)(pt,{children:p}),"INTEGER"===i.type&&Object(ze.jsxs)("span",{children:[", \u0441 \u0448\u0430\u0433\u043e\u043c ",Object(ze.jsx)(pt,{children:m})]}),Object(ze.jsx)(Ie.a,{type:"link",onClick:function(){return j((function(e){return!e}))},shape:"circle",icon:b?Object(ze.jsx)(jt.a,{}):Object(ze.jsx)(Ke.a,{})})]})})},ft=Me.b.div(ue||(ue=Object(Te.a)(["\n  color: #567;\n"]))),pt=Me.b.b(de||(de=Object(Te.a)(["\n  font-weight: 600;\n  color: rgba(0, 0, 0, 0.85);\n"]))),mt=t(408),vt=t(100),xt=function(e){var n=e.value,t=e.onChange,a=e.feature,c=Object(r.useState)(!1),i=Object(l.a)(c,2),o=i[0],u=i[1],d=Object(r.useMemo)((function(){var e,t,r;if(o){var c,i,s,l=null!==(c=null===n||void 0===n?void 0:n.values)&&void 0!==c?c:[];return(null!==(i=null===(s=a.allowed_enum_values)||void 0===s?void 0:s.values)&&void 0!==i?i:[]).map((function(e){return{title:e,checked:!l.length||l.includes(e)}}))}return(null!==(e=(null===n||void 0===n||null===(t=n.values)||void 0===t?void 0:t.length)?n.values:null===(r=a.allowed_enum_values)||void 0===r?void 0:r.values)&&void 0!==e?e:[]).map((function(e){return{title:e,checked:!1}}))}),[o,n,a]),b=Object(r.useCallback)((function(e){var n,r;if(o){var c=Object(qn.a)(d).map((function(e){return Object(s.a)({},e)})),i=c.findIndex((function(n){return n.title===e}));-1!==i&&(c[i].checked=!c[i].checked);var l=c.filter((function(e){return e.checked}));l.length&&t&&(l.length===(null!==(n=null===(r=a.allowed_enum_values)||void 0===r?void 0:r.values)&&void 0!==n?n:[]).length?t(void 0):t({values:l.map((function(e){return e.title}))}))}}),[d,a,t,o]);return Object(ze.jsxs)("div",{children:[d.map((function(e){var n=e.title,t=e.checked;return Object(ze.jsxs)(ht,{onClick:function(){return b(n)},$editmode:o,children:[o&&Object(ze.jsx)(gt,{checked:t}),n]},n)})),Object(ze.jsx)(Ie.a,{type:"link",onClick:function(){return u((function(e){return!e}))},shape:"circle",icon:o?Object(ze.jsx)(jt.a,{}):Object(ze.jsx)(Ke.a,{})})]})},ht=Object(Me.b)(mt.a)(be||(be=Object(Te.a)(["\n  ","\n  \n  transition: none;\n"])),(function(e){return e.$editmode&&Object(Me.a)(je||(je=Object(Te.a)(["\n    height: 32px;\n    line-height: 32px;\n    cursor: pointer;\n  "])))})),gt=Object(Me.b)(vt.a)(Oe||(Oe=Object(Te.a)(["\n  margin-right: 4px;\n"]))),Ct={ENUM:"allowed_enum_values",FLOAT:"allowed_float_values",INTEGER:"allowed_integer_values"},yt=function(e){var n=e.value,t=e.onChange,a=e.feature,c=e.disabled,i=Object(r.useCallback)((function(e){t(Object(s.a)(Object(s.a)({},n),e))}),[n,t]),o=a.type?Ct[a.type]:void 0;return o?Object(ze.jsx)(un.a,{name:"MappingForm",labelCol:{span:24},wrapperCol:{span:24},initialValues:n,onValuesChange:i,autoComplete:"off",colon:!1,component:"div",layout:"vertical",disabled:c,children:Object(ze.jsx)(un.a.Item,{label:"\u0414\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f:",name:o,children:"ENUM"===a.type?Object(ze.jsx)(xt,{feature:a}):Object(ze.jsx)(Ot,{feature:a})})}):Object(ze.jsx)("div",{})},kt=36e5,wt=Object(r.memo)((function(e){var n=e.value,t=void 0===n?{}:n,c=e.onChange,i=e.onDelete,u=e.requiredFeatures,d=e.features,b=e.modelMode,j=Pe(),O=Object(r.useReducer)((function(e){return(e+1)%2}),1),p=Object(l.a)(O,2),m=p[0],x=p[1],h=Object(o.useQuery)(a.transformList,f,{cacheTime:kt,onError:function(e){j(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0442\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0439")}}),g=h.data,C=void 0===g?[]:g,y=h.isLoading,k=Object(o.useQuery)(a.aggregationList,_,{cacheTime:36e5,onError:function(e){j(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0439")}}),w=k.data,S=void 0===w?[]:w,L=k.isLoading,F=Object(o.useQuery)(a.objectList,v,{cacheTime:kt,onError:function(e){j(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432")}}).data,T=void 0===F?[]:F,M=Object(r.useCallback)((function(e,n,a){var r=t[n],i=Object(qn.a)(r.mappings);i[e]=a,c&&c(Object(s.a)(Object(s.a)({},t),{},Object(An.a)({},n,Object(s.a)(Object(s.a)({},r),{},{mappings:i}))))}),[t,c]),E=Object(r.useCallback)((function(e){var n=Object(s.a)({},t);delete n[e],c&&c(n),i&&i(e)}),[t,c,i]),I=Object(r.useCallback)((function(e,n){n&&c&&c(Object(s.a)(Object(s.a)({},t),{},Object(An.a)({},e,n)))}),[t,c]),V=Object(r.useCallback)((function(e){c&&c(Object(s.a)(Object(s.a)({},t),{},Object(An.a)({},e,Object(s.a)(Object(s.a)({},t[e]),{},{mappings:[].concat(Object(qn.a)(t[e].mappings),[{}])}))))}),[t,c]),z=Object(r.useCallback)((function(e,n){x(),c&&c(Object(s.a)(Object(s.a)({},t),{},Object(An.a)({},e,Object(s.a)(Object(s.a)({},t[e]),{},{mappings:t[e].mappings.filter((function(e,t){return t!==n}))}))))}),[t,c,x]),P=Object(r.useCallback)((function(e,n){c&&c(Object(s.a)(Object(s.a)({},t),{},Object(An.a)({},e,Object(s.a)(Object(s.a)({},t[e]),{},{aggregation:null!==n&&void 0!==n?n:""}))))}),[t,c]);return Object(ze.jsx)("div",{children:Object.keys(t).map((function(e,n){var a,r=u.includes(e),c=d.find((function(n){var t=n.name;return e===t})),i=t[e].aggregation||"";return Object(ze.jsxs)("div",{children:[!!n&&Object(ze.jsx)(Ft,{}),Object(ze.jsxs)(Bn.a,{children:[Object(ze.jsx)(Jn.a,{span:1,children:Object(ze.jsx)(Ie.a,{shape:"circle",icon:Object(ze.jsx)(Yn.a,{}),disabled:r,onClick:function(){return E(e)}})}),Object(ze.jsxs)(Jn.a,{span:6,children:[r&&Object(ze.jsx)(Lt,{children:"*"}),Object(ze.jsx)(_t,{children:e}),Object(ze.jsx)(St,{children:c.type}),Object(ze.jsx)(yt,{value:t[e],onChange:function(n){return I(e,n)},feature:c,disabled:b}),(null===(a=t[e].mappings)||void 0===a?void 0:a.length)>1&&Object(ze.jsx)(un.a,{name:"AggregationForm",autoComplete:"off",colon:!1,component:"div",layout:"vertical",children:Object(ze.jsx)(un.a.Item,{label:"\u0410\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u044f:",children:Object(ze.jsx)(Un.a,{value:i,onChange:function(n){return P(e,n)},loading:L,notFoundContent:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0438 \u2026",allowClear:!0,children:(null!==S&&void 0!==S?S:[]).map((function(e){return Object(ze.jsx)(Un.a.Option,{value:e,children:e},e)}))})})})]}),Object(ze.jsxs)(Jn.a,{span:17,children:[t[e].mappings&&t[e].mappings.map((function(n,a){var r="".concat(m,".").concat(a);return Object(ze.jsxs)(Tt,{children:[Object(ze.jsx)(Ie.a,{shape:"circle",icon:Object(ze.jsx)(Yn.a,{}),disabled:t[e].mappings.length<=1,onClick:function(){return z(e,a)}}),Object(ze.jsx)(ot,{value:n,onChange:function(n){return M(a,e,n)},transformations:C,transformationsLoading:y,objects:T})]},r)})),Object(ze.jsx)(Bn.a,{children:Object(ze.jsx)(Mt,{shape:"circle",icon:Object(ze.jsx)(Hn.a,{}),onClick:function(){return V(e)}})})]})]})]},e)}))})})),_t=Me.b.span(fe||(fe=Object(Te.a)(["\n  font-weight: 600;\n  padding-left: 11px;\n"]))),St=Me.b.div(pe||(pe=Object(Te.a)(["\n  font-size: 13px;\n  color: #567;\n  padding-left: 11px;\n"]))),Lt=Me.b.div(me||(me=Object(Te.a)(["\n  display: inline-block;\n  margin-top: -2px;\n  color: #ff4d4f;\n  font-size: 18px;\n  font-family: SimSun, sans-serif;\n  position: absolute;\n"]))),Ft=Me.b.div(ve||(ve=Object(Te.a)(["\n  border-top: 2px dotted #e1e1e1;\n  height: 0;\n  margin: 8px 0 32px 0;\n"]))),Tt=Object(Me.b)(Gn.a)(xe||(xe=Object(Te.a)(["\n  margin: 15px;\n"]))),Mt=Object(Me.b)(Ie.a)(he||(he=Object(Te.a)(["\n  margin-right: 15px;\n  margin-left: auto;\n"]))),Et=36e5,It=function(e,n,t,a){if(a){var r=(null!==e&&void 0!==e?e:[]).find((function(e){return e.id===a}));if(!r)return;return(null!==n&&void 0!==n?n:[]).filter((function(e){var n=e.name;return r.features.includes(n)})).map((function(e){return Object(s.a)(Object(s.a)({},e),{},{required:!0})}))}return t&&n?n:void 0},Vt=function(e){var n=e.value,t=e.onChange,c=Pe(),i=n.category,l=n.model_id,u=Object(o.useQuery)(a.categoryList,p,{cacheTime:Et,onError:function(e){c(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439")}}),d=u.data,b=u.isLoading,j=Object(o.useQuery)(a.modelList,m,{cacheTime:0,onError:function(e){c(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043c\u043e\u0434\u0435\u043b\u0435\u0439")},onSuccess:function(e){t(Object(s.a)(Object(s.a)({},n),{},{features:It(e,x,i,l)}))}}),f=j.data,v=j.isLoading,x=Object(o.useQuery)([a.categoryFeatureList,n.category],(function(){return O(n.category)}),{cacheTime:Et,enabled:!!n.category,onError:function(e){c(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u0439")},onSuccess:function(e){t(Object(s.a)(Object(s.a)({},n),{},{features:It(f,e,i,l)}))}}).data,h=Object(r.useCallback)((function(e){if(e){var a=(null!==f&&void 0!==f?f:[]).find((function(n){return n.id===e}));t(Object(s.a)(Object(s.a)({},n),{},{model_id:e,category:n.category?n.category:a.category,features:It(f,x,i,e)}))}else t(Object(s.a)(Object(s.a)({},n),{},{model_id:void 0,features:It(f,x,i,void 0)}))}),[n,t,f,x,i]),g=Object(r.useCallback)((function(e){t(Object(s.a)(Object(s.a)({},n),{},{category:e,features:It(f,x,e,l)}))}),[n,t,f,x,l]),C=Object(r.useMemo)((function(){return i?(null!==f&&void 0!==f?f:[]).filter((function(e){return e.category===i})):null!==f&&void 0!==f?f:[]}),[f,i]);return Object(ze.jsxs)("div",{children:[Object(ze.jsx)(un.a.Item,{label:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",required:!0,children:Object(ze.jsx)(Un.a,{value:i,onChange:g,loading:b,notFoundContent:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 \u2026",disabled:!!l,allowClear:!0,children:(null!==d&&void 0!==d?d:[]).map((function(e){return Object(ze.jsx)(Un.a.Option,{value:e,children:e},e)}))})}),Object(ze.jsx)(un.a.Item,{label:"\u041c\u043e\u0434\u0435\u043b\u044c",children:Object(ze.jsx)(Un.a,{value:l,onChange:h,loading:v,notFoundContent:v?Object(ze.jsx)(ze.Fragment,{children:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043c\u043e\u0434\u0435\u043b\u0438 \u2026"}):Object(ze.jsx)(ze.Fragment,{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043c\u043e\u0434\u0435\u043b\u0435\u0439"}),allowClear:!0,children:C.map((function(e){var n=e.id,t=e.model;return Object(ze.jsx)(Un.a.Option,{value:n,children:t},n)}))})})]})},zt=Qn.a.TabPane,Pt=function(e){var n=e.value,t=e.defaultValue,a=e.onChange,c=e.loading,i=void 0!==c&&c,o=e.onValidStateChange,u=e.devices,d=Object(r.useState)([]),b=Object(l.a)(d,2),j=b[0],O=b[1],f=Object(r.useState)([]),p=Object(l.a)(f,2),m=p[0],v=p[1],x=Object(r.useState)([]),h=Object(l.a)(x,2),g=h[0],C=h[1],y=Object(r.useState)(0),k=Object(l.a)(y,2),w=k[0],_=k[1],S=n.category,L=void 0===S?"":S,F=n.model_id,T=void 0===F?"":F,M=n.feature_mappings,E=void 0===M?{}:M,I=Object(r.useMemo)((function(){var e=null===u||void 0===u?void 0:u.reduce((function(e,n){return n.home?e.add(n.home):e}),new Set);return Array.from(e||[]).map((function(e){return{value:e}}))}),[u]),V=Object(r.useState)(""),z=Object(l.a)(V,2),P=z[0],R=z[1],N=Object(r.useMemo)((function(){var e=null===u||void 0===u?void 0:u.filter((function(e){return e.home===P})).reduce((function(e,n){return n.room?e.add(n.room):e}),new Set);return Array.from(e||[]).map((function(e){return{value:e}}))}),[u,P]),q=Object(r.useState)(""),A=Object(l.a)(q,2),Q=A[0],D=A[1],B=Object(r.useCallback)((function(e){e.aliases?a(Object(s.a)(Object(s.a)({},n),{},{nicknames:e.aliases.split(",").map((function(e){return e.trim()})).filter((function(e){return!!e}))})):e.groupString?a(Object(s.a)(Object(s.a)({},n),{},{groups:e.groupString.split(",").map((function(e){return e.trim()})).filter((function(e){return!!e}))})):a(Object(s.a)(Object(s.a)({},n),e))}),[n,a]),J=Object(r.useCallback)((function(e){a(Object(s.a)(Object(s.a)({},n),{},{feature_mappings:e}))}),[n,a]),U=Object(r.useCallback)((function(e){var r=e.features,c=void 0===r?[]:r,i=e.category,o=e.model_id;O(c);var l={};(null===c||void 0===c?void 0:c.length)?l.feature_mappings=c.reduce((function(e,n){var a,r;if(o&&!n.required)return e;if(!n.required&&(!E[n.name]||0===Object.keys((null===(a=E[n.name])||void 0===a?void 0:a.mappings[0])||{}).length))return e;var c=E[n.name];return!c&&(null===t||void 0===t?void 0:t.feature_mappings)&&(c=t.feature_mappings[n.name]),e[n.name]=null!==(r=c)&&void 0!==r?r:{mappings:[{}]},e}),{}):l.feature_mappings={},v(c.filter((function(e){return e.required})).map((function(e){return e.name}))),C(c.filter((function(e){return!e.required&&!l.feature_mappings[e.name]})).map((function(e){return{value:e.name}}))),n.category!==i&&(l.category=i),n.model_id!==o&&(l.model_id=o),Object.keys(l).length&&a(Object(s.a)(Object(s.a)({},n),l))}),[n,a,E,t]),G=Object(r.useCallback)((function(e){var t=e.new_feature_name;a(Object(s.a)(Object(s.a)({},n),{},{feature_mappings:Object.assign(Object(An.a)({},t,{mappings:[{}]}),E)})),_((function(e){return e+1})),C((function(e){return e.filter((function(e){return e.value!==t}))}))}),[E,n,a]),Y=Object(r.useCallback)((function(e){C((function(n){var t=Object(qn.a)(n);return t.unshift({value:e}),t}))}),[]),H=Object(r.useMemo)((function(){return{category:L,model_id:T}}),[L,T]),K=Object(r.useMemo)((function(){var e,t;return Object(s.a)(Object(s.a)({},n),{},{aliases:(null!==(e=null===n||void 0===n?void 0:n.nicknames)&&void 0!==e?e:[]).join(", "),groupString:(null!==(t=null===n||void 0===n?void 0:n.groups)&&void 0!==t?t:[]).join(", ")})}),[n]),$=Object.keys(null!==E&&void 0!==E?E:{}).length,W=Object(r.useMemo)((function(){var e=n.category,t=n.name,a=n.feature_mappings,r=void 0===a?{}:a;if(!e||!t)return!1;var c=!0;return Object.keys(r).filter((function(e){return m.includes(e)})).forEach((function(e){if(0===r[e].mappings.length)c=!1;else{var n,t=Object(Nn.a)(r[e].mappings);try{for(t.s();!(n=t.n()).done;){var a=n.value;a.command_object&&!a.status_object&&(c=!1)}}catch(i){t.e(i)}finally{t.f()}}})),c}),[n,m]);return Object(r.useMemo)((function(){return o(W)}),[W,o]),Object(ze.jsxs)(un.a,{name:"DeviceForm",labelCol:{span:4},wrapperCol:{span:20},initialValues:K,onValuesChange:B,autoComplete:"off",labelAlign:"left",colon:!1,component:"div",children:[i&&Object(ze.jsx)(Rt,{}),Object(ze.jsxs)(Qn.a,{defaultActiveKey:"1",onChange:function(){},children:[Object(ze.jsxs)(zt,{tab:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",children:[Object(ze.jsx)(Nt,{}),Object(ze.jsx)(Vt,{value:H,onChange:U}),Object(ze.jsx)(un.a.Item,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"}],required:!0,children:Object(ze.jsx)(dn.a,{})}),Object(ze.jsx)(un.a.Item,{label:"\u0410\u043b\u0438\u0430\u0441\u044b",name:"aliases",children:Object(ze.jsx)(dn.a,{placeholder:"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e"})}),Object(ze.jsx)(un.a.Item,{label:"\u0414\u043e\u043c",name:"home",children:Object(ze.jsx)(Dn.a,{value:P,options:I,onSelect:R,onChange:R,placeholder:"\u0414\u043e\u043c",allowClear:!0})}),Object(ze.jsx)(un.a.Item,{label:"\u041a\u043e\u043c\u043d\u0430\u0442\u0430",name:"room",children:Object(ze.jsx)(Dn.a,{value:Q,options:N,onSelect:D,onChange:D,placeholder:"\u0414\u043e\u043c",allowClear:!0})}),Object(ze.jsx)(un.a.Item,{label:"\u0413\u0440\u0443\u043f\u043f\u044b",name:"groupString",children:Object(ze.jsx)(dn.a,{placeholder:"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e"})})]},"1"),$>0&&Object(ze.jsxs)(zt,{tab:"\u0424\u0443\u043d\u043a\u0446\u0438\u0438 (".concat($,")"),children:[Object(ze.jsx)(Nt,{}),Object(ze.jsxs)(Bn.a,{children:[Object(ze.jsx)(Jn.a,{span:18,offset:4,children:Object(ze.jsx)(un.a,{name:"AddForm",labelCol:{span:6},wrapperCol:{span:18},initialValues:{},onValuesChange:G,autoComplete:"off",colon:!1,children:Object(ze.jsx)(un.a.Item,{label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e",name:"new_feature_name",children:Object(ze.jsx)(Dn.a,{options:g,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u044e",disabled:!g.length})})},w)}),Object(ze.jsx)(Jn.a,{span:2})]}),Object(ze.jsx)(Ft,{}),Object(ze.jsx)(wt,{value:n.feature_mappings,requiredFeatures:m,onChange:J,onDelete:Y,features:j,modelMode:!!T})]},"2")]})]})},Rt=Object(Me.b)(jn)(ge||(ge=Object(Te.a)(["\n  transform: translate(-24px, -79px);\n"]))),Nt=Me.b.div(Ce||(Ce=Object(Te.a)(["\n  height: 16px;\n"]))),qt=function(e){var n=Object(r.useState)(!1),t=Object(l.a)(n,2),a=t[0],c=t[1],i=Object(r.useState)(e.defaultValue||{name:""}),o=Object(l.a)(i,2),u=o[0],d=o[1],b=Object(s.a)(Object(s.a)({},Je),{},{okButtonProps:Object(s.a)(Object(s.a)({},Je.okButtonProps),{},{disabled:!a})});return Object(ze.jsxs)(De.a,Object(s.a)(Object(s.a)({title:e.title,width:1100,onOk:function(){return e.onSuccess(u)},onCancel:e.onClose,bodyStyle:{paddingTop:"4px"}},b),{},{children:[Object(ze.jsx)(At,{children:Object(ze.jsx)(Pt,{value:u,defaultValue:e.defaultValue,onChange:d,onValidStateChange:c,loading:e.isLoading,devices:e.deviceList})}),!a&&Object(ze.jsxs)(Dt,{children:["\u0414\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u044f, \u043e\u0442\u043c\u0435\u0447\u0435\u043d\u043d\u044b\u0435 ",Object(ze.jsx)(Qt,{children:"*"})]})]}))},At=Me.b.div(ye||(ye=Object(Te.a)(["\n  max-height: calc(100vh - 300px);\n  overflow: auto;\n"]))),Qt=Me.b.div(ke||(ke=Object(Te.a)(["\n  display: inline-block;\n  color: #ff4d4f;\n  font-size: 18px;\n"]))),Dt=Me.b.div(we||(we=Object(Te.a)(["\n  position: absolute;\n  margin-top: 45px;\n  font-size: 15px;\n  color: #456;\n"]))),Bt=t(624),Jt=t(628),Ut=Me.b.span(_e||(_e=Object(Te.a)(["\n  color: #1890ff;\n  cursor: pointer;\n  transition: color .2s ease-in-out;\n  font-weight: 500;\n  \n  &:hover {\n    color: #40a9ff;\n  }\n"]))),Gt=Object(r.memo)((function(e){var n=e.items,t=e.loading,a=e.onEdit,c=e.onAdd,i=e.onDelete,o=Object(r.useMemo)((function(){return function(e){return[{title:"\u0414\u043e\u043c",dataIndex:"home",key:"home",sorter:function(e,n){return e.home&&n.home?e.home.localeCompare(n.home):0}},{title:"\u041a\u043e\u043c\u043d\u0430\u0442\u0430",dataIndex:"room",key:"room",sorter:function(e,n){return e.room&&n.room?e.room.localeCompare(n.room):0}},{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",key:"name",render:function(e){return Object(ze.jsx)(Ut,{children:e})},sorter:function(e,n){return e.name&&n.name?e.name.localeCompare(n.name):0}},{title:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",dataIndex:"category",key:"category",sorter:function(e,n){return e.category&&n.category?e.category.localeCompare(n.category):0}},{title:"\u041c\u043e\u0434\u0435\u043b\u044c",dataIndex:"model_name",key:"model_name"},{title:"",dataIndex:"id",key:"delete",width:64,render:function(n){return Object(ze.jsx)(Jt.a,{title:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e?",okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442",onConfirm:function(t){t.stopPropagation(),e(n)},onCancel:function(e){e.stopPropagation()},children:Object(ze.jsx)(Wn.a,{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e",children:Object(ze.jsx)(Ie.a,{shape:"circle",icon:Object(ze.jsx)(Yn.a,{}),onClick:function(e){e.stopPropagation()}})})})}}]}(i)}),[i]);return Object(ze.jsxs)("section",{children:[Object(ze.jsxs)(Yt,{children:[t&&Object(ze.jsx)(Ht,{children:Object(ze.jsx)(Kt,{size:"large"})}),Object(ze.jsx)(Bt.a,{dataSource:n.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{key:e.id})})),columns:o,pagination:!1,onRow:function(e){return{onClick:function(){return a(e)}}}})]}),Object(ze.jsx)(Ie.a,{type:"primary",size:"large",icon:Object(ze.jsx)(Hn.a,{}),onClick:c,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e"})]})})),Yt=Me.b.div(Se||(Se=Object(Te.a)(["\n  border: 1px solid #dadada;\n  padding: 8px;\n  box-shadow: 0 -2px 15px inset rgba(0, 0, 0, 0.12);\n  height: calc(100vh - 286px);\n  margin-bottom: 24px;\n  overflow: scroll;\n  position: relative;\n"]))),Ht=Me.b.div(Le||(Le=Object(Te.a)(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n  margin: -8px 0 0 -8px;\n  background: rgba(255, 255, 255, 0.8);\n"]))),Kt=Object(Me.b)(bn.a)(Fe||(Fe=Object(Te.a)(["\n  position: relative;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n"]))),$t=function(e){var n=e.deviceList,t=e.loading,a=e.onRequestListUpdate,c=Pe(),i=Object(r.useState)(null),s=Object(l.a)(i,2),u=s[0],d=s[1],b=Object(o.useMutation)(C,{onSuccess:function(){a()},onError:function(e){c(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430")}}).mutate,j=Object(o.useMutation)(g,{onSuccess:function(){d(null),a()},onError:function(e){c(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430")}}),O=j.mutate,f=j.isLoading,p=Object(r.useCallback)((function(e){d({type:"edit",device:e})}),[]),m=Object(r.useCallback)((function(){d({type:"add"})}),[]),v=Object(r.useCallback)((function(){d(null)}),[]);return Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(Gt,{loading:t,items:n,onEdit:p,onAdd:m,onDelete:b}),null!=u&&Object(ze.jsx)(qt,{title:"edit"===u.type?u.device.name:"\u041d\u043e\u0432\u043e\u0435 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e",onClose:v,onSuccess:O,deviceList:n,isLoading:f,defaultValue:"edit"===u.type?u.device:void 0})]})};var Wt=function(){var e=Pe(),n=Object(o.useQuery)(a.deviceList,h,{onError:function(n){e(n.message,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432")}}),t=n.data,c=n.isFetching,i=n.refetch,s=Object(r.useMemo)((function(){return(null===t||void 0===t?void 0:t.length)?t:[]}),[t]);return Object(ze.jsx)(ze.Fragment,{children:Object(ze.jsx)(_n,{headerLeft:"\u0423\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430",headerRight:"\u0421\u0442\u0430\u0442\u0443\u0441",contentLeft:Object(ze.jsx)($t,{deviceList:s,loading:c,onRequestListUpdate:i}),contentRight:Object(ze.jsx)(hn,{onAfterReload:i})})})},Xt=(t(617),t(618),new o.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1}}}));i.a.render(Object(ze.jsx)(o.QueryClientProvider,{client:Xt,children:Object(ze.jsx)(Wt,{})}),document.getElementById("root"))}},[[619,1,2]]]);